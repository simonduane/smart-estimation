# smart-estimation (version 02)
My activity on this was prompted by evident shortcomings in Ovo's data.

The comments below represent a snapshot, taken at a point where I think I've made significant progress towards doing better: I have a tool to facilitate detailed investigation. As a start, I'll describe what are the problems in how Ovo stores their data, an alternative way, and what a solution to the missing data problem looks like.

### Two frequencies - daily and half-hourly

Smart meters register consumption continuously, and are designed to record this consumption at 30 minute intervals. That record consists of increments in the register value (a.k.a. meter reading), and they are stored locally (in the "Communications Hub", or Comms Hub) and accessed remotely via a private network (and DCC are the gatekeepers to this access). It may be "my" data, but I can only access it if I'm a DCC "authorised user", and acquiring such a status costs money - hence the emergence of Hildebrand, Carbon, et al. who will access my data for me, "for free", provided I let them save and use my data for their own purposes. As always, if you sign up to any service that's "free", you (or your data) are the form of payment that the service provider wants. Anyway.

As a utility company selling me energy, Ovo are the only ones who ***must*** have access to data from "my" smart meter (the data may be mine, but the meter is theirs.) Ovo's choice is to ask DCC, at a time close to midnight, every 24 hours, to retrieve a daily summary of usage (48 increments in the meter reading) and one meter reading. The increments are just that - on their own, they give no information about what the meter reading is, only by how much it has changed. That is why the one meter reading is so important. Aside from anything else, it's one of those meter readings that appears as the closing reading on the monthly statement (and the same number appears as the opening reading on the following month's statement).

As far as I can tell, the Comms Hub doesn't save a history of meter readings. It only ever has a current meter reading. The history it saves (as spelt out in the SMETS standards) is 13 months' worth of half-hourly usage data. Each 30 minute interval can be regarded as having an opening meter reading and a closing meter reading, but those readings are not explicitly saved anywhere. My own tests convince me that each of those readings is a value that was in the register at a time (within a second or so of being) on the hour and half hour, UTC (Universal Coordinated Time). It would have been shown as "the meter reading", if the button on the meter had been pressed at just the right moment, and that moment would have been within a second or so of being on the hour or half-hour. (I'm labouring the point, but I fear that there is risk of confusion if this is not properly understood.)

When Ovo ask DCC to retrieve a meter reading for them, there is absolutely no guarantee that the request will reach the Comms Hub exactly on the stroke of midnight. In practice, as far as I can tell, it's several minutes off, sometimes more.

The data that Ovo make available (through an "API" that is not supported for public use, but it's there and I use it) are presented in sets of "half-hourly" and of "daily" values. For whatever reason (e.g. unreliable communications) these sets are not all complete. If they were complete, the "half-hourly" data would consist of 48 values, one for each of the 30 minute intervals between one midnight and the next, and each value is an increment in the meter reading. That is an energy, in kWh, for electricity, and what should be a volume, in m^3 for gas. Ovo's first mistake, in my humble opinion, is to save energy instead of volume for gas. But the meter registers volume of gas, not its energy content.

As it happens, Ovo use a conventional calorific value, 39.5 MJ/m^3, for the half-hourly data, instead of the "true" value as published by the National Grid the following day, so this isn't really a problem. I can apply the conversion factor and, provided I use the precise value of kWh, I am reassured that the result is always an integer multiple of 0.001 m^3. Meters register values with 3 decimal places. No more, no fewer. It's a trivial matter, but that is another reason why storing the increment as a gas volume rather than an energy content would be better. Moving on.

That meter reading, taken around midnight, could sensibly be saved with those (up to) 48 increments. It's a pretty close approximation to the meter reading that would be most useful, i.e. the meter reading ***at*** midnight. Instead, Ovo collect the meter readings and present them in another set, of "daily" values. Each set grows, day by day, and then a new set is started at the beginning of each month. Once the month is over, there is a set of values which, if complete, will have one for each day in the month. Months vary in length so, even if there were no missing data, the sets would vary in size. But there are missing data as well.

Ovo's unsupported API presents these data sets in json format, labelled either by month or by day, making it trivial (hah!) to scrape them using a Python script and insert the values into a dictionary.

The second mistake, this time more serious, is to save the key information as a list. The "half-hourly" sets of data should include lists of 48 items but, if there are any items missing, the list will be shorter - possibly even empty. The "daily" sets of data should have lists whose length might be anything from 28 to 31, but may be shorter (and could in principle, in a really bad month, be empty).

The reason this is a mistake is that the question "Which items are missing?" cannot be answered simply and directly. It's obvious ***how many*** are missing, that's merely a matter of counting, but identifying ***which ones*** are missing is possible only by checking all the time-stamps of the ones that ***are*** there. It would have been better to ***save the items in a dictionary***, keyed on date and time (their combination is known as a datetime). Then that question reduces to "Is the time-stamp of item x among the keys of the dictionary?" whose answer is immediately available.

The initial commit of code (version 02) includes a function, read_ovo, which takes one of these sets of data as input (including the important information in a list), and returns a dictionary (including that important information and keyed on datetime). Also thrown in, because it illustrates how to do things once these dictionaries have been populated, are a few lines to put up interactive matplotlib graphs, and the conversion of gas energy to gas volume. When it comes to the estimation of meter readings, the dictionaries will be used to populate numpy arrays in which missing values are made explicit and space is reserved for values (estimates) to be inserted to fill the gaps.